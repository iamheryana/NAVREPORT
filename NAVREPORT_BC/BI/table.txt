CREATE TABLE dbo.M_BRANCH  
   (BRANCH_CODE nvarchar(10) PRIMARY KEY NOT NULL,  
    BRANCH_NAME nvarchar(50)  NULL,
    BRANCH_ADDRESS nvarchar(50)  NULL,
    BRANCH_ADDRESS2 nvarchar(50)  NULL,
    CITY nvarchar(30)  NULL,
    POSTCODE nvarchar(20)  NULL,
    PHONE nvarchar(30)  NULL,
    CONTACT nvarchar(50)  NULL);
--   
CREATE TABLE dbo.M_SALESPEOPLE
   (SALES nvarchar(10) NOT NULL,  
    SALES_NAME nvarchar(50)  NULL,
    BRANCH_CODE nvarchar(10)  NULL,
    EMAIL nvarchar(80)  NULL,
    PHONE nvarchar(30)  NULL,
    TITLE nvarchar(30)  NULL,	
	CONSTRAINT PK_SALESPEOPLE PRIMARY KEY NONCLUSTERED (SALES),
	CONSTRAINT FK_SALESPEOPLE_BRANCH FOREIGN KEY (BRANCH_CODE)
		REFERENCES dbo.M_BRANCH (BRANCH_CODE)
		ON DELETE CASCADE
		ON UPDATE CASCADE
    );
--    
CREATE TABLE dbo.M_CUSTOMER
   (CUSTOMER_NO nvarchar(20) NOT NULL,  
    CUSTOMER_NAME nvarchar(50)  NULL,
    CUSTOMER_ADDRESS nvarchar(50)  NULL,
    CUSTOMER_ADDRESS2 nvarchar(50)  NULL,
    CITY nvarchar(30)  NULL,
    CONTACT nvarchar(50)  NULL,
    PHONE nvarchar(30)  NULL,
    CUSTOMER_POSTING_GROUP nvarchar(30) NULL,
    SALES nvarchar(10)  NULL,
    CONSTRAINT PK_CUSTOMER PRIMARY KEY NONCLUSTERED (CUSTOMER_NO),
	CONSTRAINT FK_CUSTOMER_SALESPEOPLE FOREIGN KEY (SALES)
		REFERENCES dbo.M_SALESPEOPLE (SALES)
		ON DELETE CASCADE
		ON UPDATE CASCADE    
    );
-- 
CREATE TABLE dbo.M_DIMENSION
   (COMPANY nvarchar(8) NOT NULL,  
	DIMENSION_ID INT NOT NULL,
	BRANCH_CODE nvarchar(10) NULL,
	BRANCH_NAME nvarchar(10) NULL,
	PRODUCT_CODE nvarchar(20) NULL,	
	PRODUCT nvarchar(50) NULL,	
	PRINCIPAL_CODE nvarchar(20) NULL,	
	PRINCIPAL nvarchar(50) NULL,		
	ITEM_CAT_CODE nvarchar(20) NULL,	
	ITEM_CAT nvarchar(50) NULL,	
	APPLICATIONS_CODE nvarchar(20) NULL,	
	APPLICATIONS nvarchar(50) NULL,	
	PROJECT_CODE nvarchar(20) NULL,	
	PROJECT nvarchar(50) NULL, 
	SECTOR_INDUSTRY_CODE  nvarchar(20) NULL,
	SECTOR_INDUSTRY	nvarchar(50) NULL, 
	SALESMAN_CODE nvarchar(20) NULL,
	SALESMAN nvarchar(50) NULL, 
    CONSTRAINT PK_DIMENSION PRIMARY KEY NONCLUSTERED (COMPANY,DIMENSION_ID)  
    );
 --    
 CREATE TABLE dbo.T_SALES
   (
	COMPANY nvarchar(8) NOT NULL,  
    DOCUMENT_NO nvarchar(20) NOT NULL,	
    LINE_NO INT NOT NULL,
    POSTING_DATE DATETIME NOT NULL,
    SELLTO_CUSTOMER_NO nvarchar(20) NULL,  
    SELLTO_CUSTOMER_NAME nvarchar(50)  NULL,
    BILLTO_CUSTOMER_NO nvarchar(20) NULL,  
    BILLTO_CUSTOMER_NAME nvarchar(50)  NULL,
	POSTING_DESC nvarchar(50)  NULL,
	TERM_OF_PAY nvarchar(10)  NULL,
	CUST_POST_GROUP nvarchar(10) NULL,
	CURRENCY nvarchar(10)  NULL,
	SALES nvarchar(10) NULL,
	ORDER_NO nvarchar(20) NULL,
	NO_PO_CUST nvarchar(35) NULL,
	NO_FAKTUR_PAJAK nvarchar(50)  NULL,
    TIPE_LINE INT NULL,
    ITEM_NO nvarchar(20) NULL,
    ITEM_DESC nvarchar(50)  NULL,
    ITEM_DESC2 nvarchar(50)  NULL,
	QTY DECIMAL(38,20) NULL,
	UOM nvarchar(10) NULL,
	UNIT_PRICE DECIMAL(38,20) NULL,
	AMOUNT DECIMAL(38,20) NULL,
	AMOUNT_IDR DECIMAL(38,20) NULL,
	DIMENSION_ID INT NOT NULL,
    CONSTRAINT PK_SALES PRIMARY KEY NONCLUSTERED (COMPANY,DOCUMENT_NO,LINE_NO)
    );
-- 
CREATE TABLE dbo.M_PARAM(
	COMPANY nvarchar(8) NOT NULL, 
	REGISTER nvarchar(10) NOT NULL,   
	DIMENSION_ID int NULL,
	DOCUMENT_NO nvarchar(20)  NULL,   
    CONSTRAINT PK_PARAM PRIMARY KEY NONCLUSTERED (COMPANY,REGISTER)
);
--
CREATE TABLE dbo.T_SALES_REV
   (
  	COMPANY nvarchar(8) NOT NULL,  
    DOCUMENT_NO nvarchar(20) NOT NULL,	
    LINE_NO INT NOT NULL,
    POSTING_DATE DATETIME NOT NULL,
    SELLTO_CUSTOMER_NO nvarchar(20) NULL,  
    SELLTO_CUSTOMER_NAME nvarchar(50)  NULL,
    BILLTO_CUSTOMER_NO nvarchar(20) NULL,  
    BILLTO_CUSTOMER_NAME nvarchar(50)  NULL,
	POSTING_DESC nvarchar(50)  NULL,
	TERM_OF_PAY nvarchar(10)  NULL,
	CUST_POST_GROUP nvarchar(10) NULL,
	CURRENCY nvarchar(10)  NULL,
	SALES nvarchar(10) NULL,
	ORDER_NO nvarchar(20) NULL,
	NO_PO_CUST nvarchar(35) NULL,
	NO_FAKTUR_PAJAK nvarchar(50)  NULL,
    TIPE_LINE INT NULL,
    ITEM_NO nvarchar(20) NULL,
    ITEM_DESC nvarchar(50)  NULL,
    ITEM_DESC2 nvarchar(50)  NULL,
    QTY_BASE DECIMAL(38,20) NULL,
	UOM_BASE nvarchar(10) NULL,
	QTY DECIMAL(38,20) NULL,
	UOM nvarchar(10) NULL,
	UNIT_PRICE DECIMAL(38,20) NULL,
	AMOUNT DECIMAL(38,20) NULL,
	AMOUNT_IDR DECIMAL(38,20) NULL,
	DIMENSION_ID INT NOT NULL,
    CONSTRAINT PK_SALES_REV PRIMARY KEY NONCLUSTERED (COMPANY,DOCUMENT_NO,LINE_NO)
);
--
CREATE TABLE dbo.M_PARAM_REV(
	COMPANY nvarchar(8) NOT NULL, 
	REGISTER nvarchar(10) NOT NULL,   
	DIMENSION_ID int NULL,
	DOCUMENT_NO nvarchar(20)  NULL,   
    CONSTRAINT PK_PARAM_REV PRIMARY KEY NONCLUSTERED (COMPANY,REGISTER)
); 
--
 CREATE TABLE dbo.M_TANGGAL
   (
    POSTING_DATE DATETIME PRIMARY KEY NOT NULL,
    TAHUN INT NULL,
    KUARTAL INT NULL,
    BULAN INT NULL,
    MINGGU INT NULL,
    TANGGAL INT NULL    
    );
--
--
DECLARE @cnt INT = 0;
DECLARE @PostingDate DATETIME = (SELECT MIN([POSTING_DATE]) - 34 FROM [NavBI].[dbo].[T_SALES]);
WHILE @cnt < (365 * 20)
BEGIN
	INSERT INTO dbo.M_TANGGAL (POSTING_DATE ,TAHUN,KUARTAL,BULAN,MINGGU,TANGGAL)    
	VALUES ((@PostingDate+@cnt), 
				DATEPART(year ,(@PostingDate+@cnt)),
				DATEPART(quarter ,(@PostingDate+@cnt)),
				DATEPART(month ,(@PostingDate+@cnt)),
				DATEPART( wk ,(@PostingDate+@cnt)),
				DATEPART(day,(@PostingDate+@cnt)));  
   SET @cnt = @cnt + 1;
END;





CREATE SEQUENCE T01_ID_SEQ
    START WITH 1
    INCREMENT BY 1
    NO CACHE
    ;
GO

CREATE TABLE T01_ZEBRA_ORI
(
    T01_ID bigint PRIMARY KEY NOT NULL DEFAULT (NEXT VALUE FOR T01_ID_SEQ),
    KET nvarchar(50) NOT NULL
);

CREATE TABLE dbo.M_PARAM_TIME (
	LAST_UPDATE  DATETIME PRIMARY KEY NOT NULL);




ALTER TABLE [NavBI].[dbo].[T_SALES_REV]
ADD 
	[BRANCH_CODE] [nvarchar](10) NULL,
	[BRANCH_NAME] [nvarchar](10) NULL,
	[PRODUCT_CODE] [nvarchar](20) NULL,
	[PRODUCT] [nvarchar](50) NULL,
	[PRINCIPAL_CODE] [nvarchar](20) NULL,
	[PRINCIPAL] [nvarchar](50) NULL,
	[ITEM_CAT_CODE] [nvarchar](20) NULL,
	[ITEM_CAT] [nvarchar](50) NULL,
	[APPLICATIONS_CODE] [nvarchar](20) NULL,
	[APPLICATIONS] [nvarchar](50) NULL,
	[PROJECT_CODE] [nvarchar](20) NULL,
	[PROJECT] [nvarchar](50) NULL,
	[SECTOR_INDUSTRY_CODE] [nvarchar](20) NULL,
	[SECTOR_INDUSTRY] [nvarchar](50) NULL,
	[SALESMAN_CODE] [nvarchar](20) NULL,
	[SALESMAN] [nvarchar](50) NULL;

