USE [NavBI]
GO
/****** Object:  StoredProcedure [dbo].[P_SALES_COGS_CORRECTION_2022]    Script Date: 07-02-2023 4:56:25 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[P_SALES_COGS_CORRECTION_2022] 
	@ProsesId  nvarchar(100) ,  
	@Cabang  nvarchar(15),
	@PeriodeFrom  datetime , 
	@PeriodeUpto  datetime , 	
	@Action  nvarchar(15)
AS   
BEGIN
	DECLARE @TglInvFrom DATETIME = CAST(@PeriodeFrom AS DATETIME);
	DECLARE @TglInvUpto DATETIME = CAST(@PeriodeUpto AS DATETIME);
	--
	IF @Action = 'CETAK'
	BEGIN
		INSERT INTO [dbo].[TEMP10_SALES_COGS_CORRECTION]
				   ([GRUP_SC]
				   ,[SUB_GRUP_SC]
				   ,[SUB_GRUP_TITLE]
				   ,[TITLE]
				   ,[SORT_SLS]
				   ,[AMOUNT_AJ]
				   ,[AMOUNT_SP]
				   ,[PROSES_ID]
				   ,[SOURCE_FROM])
		SELECT	X.GRUP_SC
				,X.SUB_GRUP_SC
				,X.SUB_GRUP_TITLE
				,X.TITLE
				,X.SORT_SLS
				,X.AMOUNT_AJ
				,X.AMOUNT_SP
				,@ProsesId AS PROSES_ID
				,X.SOURCE_FROM
		FROM	(
					SELECT	'01-SALES' AS GRUP_SC
							,'01-SALES' AS SUB_GRUP_SC
							,CASE	WHEN DIMS.ITEM_CAT = 'HW01' THEN '1. Sales - HARDWARE'
									WHEN DIMS.ITEM_CAT = 'PS01' THEN '2. Sales - 3rd PARTY SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS02' THEN '3. Sales - OWN SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS03' THEN '4. Sales - TECHNOLOGY SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS04' THEN '5. Sales - HARDWARE SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS05' THEN '6. Sales - MANAGE SERVICE'
							END AS SUB_GRUP_TITLE
							,CASE	WHEN DIMS.ITEM_CAT = 'HW01' THEN 'Sales - HARDWARE'
									WHEN DIMS.ITEM_CAT = 'PS01' THEN 'Sales - 3rd PARTY SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS02' THEN 'Sales - OWN SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS03' THEN 'Sales - TECHNOLOGY SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS04' THEN 'Sales - HARDWARE SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS05' THEN 'Sales - MANAGE SERVICE'
							END AS TITLE
							,'SLS-00' AS SORT_SLS
							,SUM(GLE.[Amount]) * -1 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'AUTOJAYA' AS SOURCE_FROM
					FROM [ACS].[dbo].[AUTOJAYA$G_L Entry] GLE
					LEFT JOIN	(
									SELECT	DIM.DIM_ID
											,MAX(DIM.BRANCHES) AS BRANCHES
											,MAX(DIM.ITEM_CAT) AS ITEM_CAT
											,MAX(DIM.SALESMAN) AS SALESMAN
									FROM	(
												SELECT [Dimension Set ID] AS DIM_ID
													  ,CASE WHEN [Dimension Code] = 'BRANCHES' THEN [Dimension Value Code] ELSE NULL END AS BRANCHES
													  ,CASE WHEN [Dimension Code] = 'ITEM CATEGORY' THEN [Dimension Value Code] ELSE NULL END AS ITEM_CAT
													  ,CASE WHEN [Dimension Code] = 'SALESMAN' THEN [Dimension Value Code] ELSE NULL END AS SALESMAN
												FROM [ACS].[dbo].[AUTOJAYA$Dimension Set Entry]
											) DIM
									GROUP BY DIM.DIM_ID
								) DIMS ON DIMS.DIM_ID = GLE.[Dimension Set ID]
					WHERE	(GLE.[G_L Account No_] BETWEEN '400.110.00'  AND '420.110.01') AND
							GLE.[G_L Account No_] <> '400.110.04' AND
							DIMS.ITEM_CAT <> '' AND
							(DIMS.BRANCHES = @Cabang OR @Cabang = 'ALL') AND
							(GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <=  @TglInvUpto)
					GROUP BY DIMS.ITEM_CAT
					UNION ALL
					SELECT	'01-SALES' AS GRUP_SC
							,'01-SALES' AS SUB_GRUP_SC
							,'7. Sales - LAINNYA' AS SUB_GRUP_TITLE
							,'Sales - LAINNYA' AS TITLE
							,'SLS-00' AS SORT_SLS
							,SUM(GLE.[Amount]) * -1 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'AUTOJAYA' AS SOURCE_FROM
					FROM [ACS].[dbo].[AUTOJAYA$G_L Entry] GLE
					LEFT JOIN	(
									SELECT	DIM.DIM_ID
											,MAX(DIM.BRANCHES) AS BRANCHES
											,MAX(DIM.ITEM_CAT) AS ITEM_CAT
											,MAX(DIM.SALESMAN) AS SALESMAN
									FROM	(
												SELECT [Dimension Set ID] AS DIM_ID
													  ,CASE WHEN [Dimension Code] = 'BRANCHES' THEN [Dimension Value Code] ELSE NULL END AS BRANCHES
													  ,CASE WHEN [Dimension Code] = 'ITEM CATEGORY' THEN [Dimension Value Code] ELSE NULL END AS ITEM_CAT
													  ,CASE WHEN [Dimension Code] = 'SALESMAN' THEN [Dimension Value Code] ELSE NULL END AS SALESMAN
												FROM [ACS].[dbo].[AUTOJAYA$Dimension Set Entry]
											) DIM
									GROUP BY DIM.DIM_ID
								) DIMS ON DIMS.DIM_ID = GLE.[Dimension Set ID]
					WHERE	GLE.[G_L Account No_] = '400.110.04' AND
							(DIMS.BRANCHES = @Cabang OR @Cabang = 'ALL') AND
							(GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <=  @TglInvUpto)
					GROUP BY DIMS.ITEM_CAT
					UNION ALL
					SELECT	'01-SALES' AS GRUP_SC
							,'01-SALES' AS SUB_GRUP_SC
							,CASE	WHEN DIMS.ITEM_CAT = 'HW01' THEN '1. Sales - HARDWARE'
									WHEN DIMS.ITEM_CAT = 'PS01' THEN '2. Sales - 3rd PARTY SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS02' THEN '3. Sales - OWN SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS03' THEN '4. Sales - TECHNOLOGY SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS04' THEN '5. Sales - HARDWARE SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS05' THEN '6. Sales - MANAGE SERVICE'
							 END AS SUB_GRUP_TITLE
							,'(-/+) Others Management Adjustment' AS TITLE
							,'SLS-03' AS SORT_SLS
							,SUM(GLE.[Amount]) * -1 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'AJ-ADJ' AS SOURCE_FROM
					FROM [ACS].[dbo].[AJ-ADJ$G_L Entry] GLE
					LEFT JOIN	(
									SELECT	DIM.DIM_ID
											,MAX(DIM.BRANCHES) AS BRANCHES
											,MAX(DIM.ITEM_CAT) AS ITEM_CAT
											,MAX(DIM.SALESMAN) AS SALESMAN
									FROM	(
												SELECT [Dimension Set ID] AS DIM_ID
													  ,CASE WHEN [Dimension Code] = 'BRANCHES' THEN [Dimension Value Code] ELSE NULL END AS BRANCHES
													  ,CASE WHEN [Dimension Code] = 'ITEM CATEGORY' THEN [Dimension Value Code] ELSE NULL END AS ITEM_CAT
													  ,CASE WHEN [Dimension Code] = 'SALESMAN' THEN [Dimension Value Code] ELSE NULL END AS SALESMAN
												FROM [ACS].[dbo].[AJ-ADJ$Dimension Set Entry]
											) DIM
									GROUP BY DIM.DIM_ID
								) DIMS ON DIMS.DIM_ID = GLE.[Dimension Set ID]
					WHERE	(GLE.[G_L Account No_] BETWEEN '400.110.00'  AND '420.110.01') AND
							GLE.[G_L Account No_] <> '400.110.04' AND
							DIMS.ITEM_CAT <> '' AND
							(DIMS.BRANCHES = @Cabang OR @Cabang = 'ALL') AND
							(GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <=  @TglInvUpto)
					GROUP BY DIMS.ITEM_CAT
					UNION ALL
					SELECT	'01-SALES' AS GRUP_SC
							,'01-SALES' AS SUB_GRUP_SC
							,'7. Sales - LAINNYA' AS SUB_GRUP_TITLE
							,'(-/+) Others Management Adjustment' AS TITLE
							,'SLS-03' AS SORT_SLS
							,SUM(GLE.[Amount]) * -1 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'AJ-ADJ' AS SOURCE_FROM
					FROM [ACS].[dbo].[AJ-ADJ$G_L Entry] GLE
					LEFT JOIN	(
									SELECT	DIM.DIM_ID
											,MAX(DIM.BRANCHES) AS BRANCHES
											,MAX(DIM.ITEM_CAT) AS ITEM_CAT
											,MAX(DIM.SALESMAN) AS SALESMAN
									FROM	(
												SELECT [Dimension Set ID] AS DIM_ID
													  ,CASE WHEN [Dimension Code] = 'BRANCHES' THEN [Dimension Value Code] ELSE NULL END AS BRANCHES
													  ,CASE WHEN [Dimension Code] = 'ITEM CATEGORY' THEN [Dimension Value Code] ELSE NULL END AS ITEM_CAT
													  ,CASE WHEN [Dimension Code] = 'SALESMAN' THEN [Dimension Value Code] ELSE NULL END AS SALESMAN
												FROM [ACS].[dbo].[AJ-ADJ$Dimension Set Entry]
											) DIM
									GROUP BY DIM.DIM_ID
								) DIMS ON DIMS.DIM_ID = GLE.[Dimension Set ID]
					WHERE	GLE.[G_L Account No_] = '400.110.04' AND
							(DIMS.BRANCHES = @Cabang OR @Cabang = 'ALL') AND
							(GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <=  @TglInvUpto)
					GROUP BY DIMS.ITEM_CAT
					UNION ALL
					SELECT	'01-SALES' AS GRUP_SC
							,'02-SALES CORRECTION' AS SUB_GRUP_SC
							, SLC.SALES_TITLE AS SUB_GRUP_TITLE
							, SLC.SALES_TITLE2 AS TITLE
							, SLC.SORT_SLS
							, SUM(SLC.[Amount]) AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'AUTOJAYA' AS SOURCE_FROM
					FROM	(
								SELECT	CASE WHEN GLE.[Source No_] = 'SOPE001' THEN '2. Sales INTERCOY' ELSE '1. Sales FA' END AS SALES_TITLE
										,CASE WHEN GLE.[Source No_] = 'SOPE001' THEN '(-) Sales INTERCOY' ELSE '(-) Sales FA' END AS SALES_TITLE2
										,CASE WHEN GLE.[Source No_] = 'SOPE001' THEN 'SLS-0302' ELSE 'SLS-0301' END AS SORT_SLS
										, GLE.[Amount]
										, GLE.[Global Dimension 1 Code] AS BRANCHES
								FROM [ACS].[dbo].[AUTOJAYA$G_L Entry] GLE
								WHERE GLE.[G_L Account No_] IN ('400.110.01', '410.110.01', '420.110.01')
										AND GLE.[Document No_] <> '9SIAT200197'
										AND GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <=  @TglInvUpto
							) SLC
					WHERE (SLC.BRANCHES = @Cabang OR @Cabang = 'ALL')
					GROUP BY SLC.SALES_TITLE, SLC.SALES_TITLE2, SLC.SORT_SLS
					UNION ALL
					SELECT	'01-SALES' AS GRUP_SC
							,'02-SALES CORRECTION' AS SUB_GRUP_SC
							, SLC.SALES_TITLE AS SUB_GRUP_TITLE
							, SLC.SALES_TITLE2 AS TITLE
							, SLC.SORT_SLS
							, SUM(SLC.[Amount]) AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'AJ-ADJ' AS SOURCE_FROM
					FROM	(
								SELECT	'3. Others Sales Adjustment' AS SALES_TITLE
										,'(-/+) Others Management Adjustment' AS SALES_TITLE2
										,'SLS-0303' AS SORT_SLS
										, GLE.[Amount]
								FROM [ACS].[dbo].[AJ-ADJ$G_L Entry] GLE
								WHERE GLE.[G_L Account No_] IN ('400.110.01', '410.110.01', '420.110.01')
										AND GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <=  @TglInvUpto
							) SLC
					WHERE @Cabang = 'ALL' OR @Cabang = '10'
					GROUP BY SLC.SALES_TITLE, SLC.SALES_TITLE2, SLC.SORT_SLS
					UNION ALL
					SELECT	'01-SALES' AS GRUP_SC
							,'01-SALES' AS SUB_GRUP_SC
							,CASE	WHEN DIMS.ITEM_CAT = 'HW01' THEN '1. Sales - HARDWARE'
									WHEN DIMS.ITEM_CAT = 'PS01' THEN '2. Sales - 3rd PARTY SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS02' THEN '3. Sales - OWN SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS03' THEN '4. Sales - TECHNOLOGY SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS04' THEN '5. Sales - HARDWARE SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS05' THEN '6. Sales - MANAGE SERVICE'
							END AS SUB_GRUP_TITLE
							,CASE	WHEN DIMS.ITEM_CAT = 'HW01' THEN 'Sales - HARDWARE'
									WHEN DIMS.ITEM_CAT = 'PS01' THEN 'Sales - 3rd PARTY SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS02' THEN 'Sales - OWN SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS03' THEN 'Sales - TECHNOLOGY SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS04' THEN 'Sales - HARDWARE SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS05' THEN 'Sales - MANAGE SERVICE'
							END AS TITLE
							,'SLS-00' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, SUM(GLE.[Amount]) * -1 AS AMOUNT_SP
							,'SOLUSI' AS SOURCE_FROM
					FROM [ACS].[dbo].[SOLUSI$G_L Entry] GLE
					LEFT JOIN	(
									SELECT	DIM.DIM_ID
											,MAX(DIM.BRANCHES) AS BRANCHES
											,MAX(DIM.ITEM_CAT) AS ITEM_CAT
											,MAX(DIM.SALESMAN) AS SALESMAN
									FROM	(
												SELECT [Dimension Set ID] AS DIM_ID
													  ,CASE WHEN [Dimension Code] = 'BRANCHES' THEN [Dimension Value Code] ELSE NULL END AS BRANCHES
													  ,CASE WHEN [Dimension Code] = 'ITEM CATEGORY' THEN [Dimension Value Code] ELSE NULL END AS ITEM_CAT
													  ,CASE WHEN [Dimension Code] = 'SALESMAN' THEN [Dimension Value Code] ELSE NULL END AS SALESMAN
												FROM [ACS].[dbo].[SOLUSI$Dimension Set Entry]
											) DIM
									GROUP BY DIM.DIM_ID
								) DIMS ON DIMS.DIM_ID = GLE.[Dimension Set ID]
					WHERE	(GLE.[G_L Account No_] BETWEEN '400.110.00'  AND '420.110.01') AND
							GLE.[G_L Account No_] <> '400.110.04' AND
							DIMS.ITEM_CAT <> '' AND
							(DIMS.BRANCHES = @Cabang OR @Cabang = 'ALL') AND
							(GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <=  @TglInvUpto)
					GROUP BY DIMS.ITEM_CAT
					UNION ALL
					SELECT	'01-SALES' AS GRUP_SC
							,'01-SALES' AS SUB_GRUP_SC
							,'7. Sales - LAINNYA' AS SUB_GRUP_TITLE
							,'Sales - LAINNYA' AS TITLE
							,'SLS-00' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, SUM(GLE.[Amount]) * -1 AS AMOUNT_SP
							,'SOLUSI' AS SOURCE_FROM
					FROM [ACS].[dbo].[SOLUSI$G_L Entry] GLE
					LEFT JOIN	(
									SELECT	DIM.DIM_ID
											,MAX(DIM.BRANCHES) AS BRANCHES
											,MAX(DIM.ITEM_CAT) AS ITEM_CAT
											,MAX(DIM.SALESMAN) AS SALESMAN
									FROM	(
												SELECT [Dimension Set ID] AS DIM_ID
													  ,CASE WHEN [Dimension Code] = 'BRANCHES' THEN [Dimension Value Code] ELSE NULL END AS BRANCHES
													  ,CASE WHEN [Dimension Code] = 'ITEM CATEGORY' THEN [Dimension Value Code] ELSE NULL END AS ITEM_CAT
													  ,CASE WHEN [Dimension Code] = 'SALESMAN' THEN [Dimension Value Code] ELSE NULL END AS SALESMAN
												FROM [ACS].[dbo].[SOLUSI$Dimension Set Entry]
											) DIM
									GROUP BY DIM.DIM_ID
								) DIMS ON DIMS.DIM_ID = GLE.[Dimension Set ID]
					WHERE	GLE.[G_L Account No_] = '400.110.04' AND
							(DIMS.BRANCHES = @Cabang OR @Cabang = 'ALL') AND
							(GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <=  @TglInvUpto)
					GROUP BY DIMS.ITEM_CAT
					UNION ALL
					SELECT	'01-SALES' AS GRUP_SC
							,'01-SALES' AS SUB_GRUP_SC
							,CASE	WHEN DIMS.ITEM_CAT = 'HW01' THEN '1. Sales - HARDWARE'
									WHEN DIMS.ITEM_CAT = 'PS01' THEN '2. Sales - 3rd PARTY SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS02' THEN '3. Sales - OWN SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS03' THEN '4. Sales - TECHNOLOGY SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS04' THEN '5. Sales - HARDWARE SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS05' THEN '6. Sales - MANAGE SERVICE'
							 END AS SUB_GRUP_TITLE
							,'(-/+) Others Management Adjustment' AS TITLE
							,'SLS-03' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, SUM(GLE.[Amount]) * -1 AS AMOUNT_SP
							,'SP-ADJ' AS SOURCE_FROM
					FROM [ACS].[dbo].[SP-ADJ$G_L Entry] GLE
					LEFT JOIN	(
									SELECT	DIM.DIM_ID
											,MAX(DIM.BRANCHES) AS BRANCHES
											,MAX(DIM.ITEM_CAT) AS ITEM_CAT
											,MAX(DIM.SALESMAN) AS SALESMAN
									FROM	(
												SELECT [Dimension Set ID] AS DIM_ID
													  ,CASE WHEN [Dimension Code] = 'BRANCHES' THEN [Dimension Value Code] ELSE NULL END AS BRANCHES
													  ,CASE WHEN [Dimension Code] = 'ITEM CATEGORY' THEN [Dimension Value Code] ELSE NULL END AS ITEM_CAT
													  ,CASE WHEN [Dimension Code] = 'SALESMAN' THEN [Dimension Value Code] ELSE NULL END AS SALESMAN
												FROM [ACS].[dbo].[SP-ADJ$Dimension Set Entry]
											) DIM
									GROUP BY DIM.DIM_ID
								) DIMS ON DIMS.DIM_ID = GLE.[Dimension Set ID]
					WHERE	(GLE.[G_L Account No_] BETWEEN '400.110.00'  AND '420.110.01') AND
							GLE.[G_L Account No_] <> '400.110.04' AND
							DIMS.ITEM_CAT <> '' AND
							(DIMS.BRANCHES = @Cabang OR @Cabang = 'ALL') AND
							(GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <= @TglInvUpto)
					GROUP BY DIMS.ITEM_CAT
					UNION ALL
					SELECT	'01-SALES' AS GRUP_SC
							,'01-SALES' AS SUB_GRUP_SC
							,'7. Sales - LAINNYA' AS SUB_GRUP_TITLE
							,'(-/+) Others Management Adjustment' AS TITLE
							,'SLS-03' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, SUM(GLE.[Amount]) * -1 AS AMOUNT_SP
							,'SP-ADJ' AS SOURCE_FROM
					FROM [ACS].[dbo].[SP-ADJ$G_L Entry] GLE
					LEFT JOIN	(
									SELECT	DIM.DIM_ID
											,MAX(DIM.BRANCHES) AS BRANCHES
											,MAX(DIM.ITEM_CAT) AS ITEM_CAT
											,MAX(DIM.SALESMAN) AS SALESMAN
									FROM	(
												SELECT [Dimension Set ID] AS DIM_ID
													  ,CASE WHEN [Dimension Code] = 'BRANCHES' THEN [Dimension Value Code] ELSE NULL END AS BRANCHES
													  ,CASE WHEN [Dimension Code] = 'ITEM CATEGORY' THEN [Dimension Value Code] ELSE NULL END AS ITEM_CAT
													  ,CASE WHEN [Dimension Code] = 'SALESMAN' THEN [Dimension Value Code] ELSE NULL END AS SALESMAN
												FROM [ACS].[dbo].[SP-ADJ$Dimension Set Entry]
											) DIM
									GROUP BY DIM.DIM_ID
								) DIMS ON DIMS.DIM_ID = GLE.[Dimension Set ID]
					WHERE	GLE.[G_L Account No_] = '400.110.04' AND
							(DIMS.BRANCHES = @Cabang OR @Cabang = 'ALL') AND
							(GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <= @TglInvUpto)
					GROUP BY DIMS.ITEM_CAT
					UNION ALL
					SELECT	'01-SALES' AS GRUP_SC
							,'02-SALES CORRECTION' AS SUB_GRUP_SC
							, SLC.SALES_TITLE AS SUB_GRUP_TITLE
							, SLC.SALES_TITLE2 AS TITLE
							, SLC.SORT_SLS
							, 0 AS AMOUNT_AJ
							, SUM(SLC.[Amount]) AS AMOUNT_SP
							,'SOLUSI' AS SOURCE_FROM
					FROM	(
								SELECT	CASE WHEN GLE.[Source No_] <> 'SOPE001' THEN '2. Sales INTERCOY' ELSE '1. Sales FA' END AS SALES_TITLE
										,CASE WHEN GLE.[Source No_] <> 'SOPE001' THEN '(-) Sales INTERCOY' ELSE '(-) Sales FA' END AS SALES_TITLE2
										,CASE WHEN GLE.[Source No_] <> 'SOPE001' THEN 'SLS-0302' ELSE 'SLS-0301' END AS SORT_SLS
										, GLE.[Amount]
										, GLE.[Global Dimension 1 Code] AS BRANCHES
								FROM [ACS].[dbo].[SOLUSI$G_L Entry] GLE
								WHERE GLE.[G_L Account No_] IN ('400.110.01', '410.110.01', '420.110.01')
										AND (GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <= @TglInvUpto)
							) SLC
					WHERE (SLC.BRANCHES = @Cabang OR @Cabang = 'ALL')
					GROUP BY SLC.SALES_TITLE, SLC.SALES_TITLE2, SLC.SORT_SLS
					UNION ALL
					SELECT	'01-SALES' AS GRUP_SC
							,'02-SALES CORRECTION' AS SUB_GRUP_SC
							, SLC.SALES_TITLE AS SUB_GRUP_TITLE
							, SLC.SALES_TITLE2 AS TITLE
							, SLC.SORT_SLS
							, 0 AS AMOUNT_AJ
							, SUM(SLC.[Amount]) AS AMOUNT_SP
							,'SP-ADJ' AS SOURCE_FROM
					FROM	(
								SELECT	'3. Others Sales Adjustment' AS SALES_TITLE
										,'(-/+) Others Management Adjustment' AS SALES_TITLE2
										,'SLS-0303' AS SORT_SLS
										, GLE.[Amount]
								FROM [ACS].[dbo].[SP-ADJ$G_L Entry] GLE
								WHERE GLE.[G_L Account No_] IN ('400.110.01', '410.110.01', '420.110.01')
										AND GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <=  @TglInvUpto
							) SLC
					WHERE @Cabang = 'ALL' OR @Cabang = '10'
					GROUP BY SLC.SALES_TITLE, SLC.SALES_TITLE2, SLC.SORT_SLS
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'1. COGS - HARDWARE' AS SUB_GRUP_TITLE
							,'COGS - HARDWARE' AS TITLE
							,'SLS-00' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'1. COGS - HARDWARE' AS SUB_GRUP_TITLE
							,'(+) Accured COGS Previous Year' AS TITLE
							,'SLS-01' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'1. COGS - HARDWARE' AS SUB_GRUP_TITLE
							,'(-) Accured COGS Current Year' AS TITLE
							,'SLS-02' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'1. COGS - HARDWARE' AS SUB_GRUP_TITLE
							,'(-/+) Others Management Adjustment' AS TITLE
							,'SLS-03' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'2. COGS - 3rd PARTY SOFTWARE' AS SUB_GRUP_TITLE
							,'COGS - 3rd PARTY SOFTWARE' AS TITLE
							,'SLS-00' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'2. COGS - 3rd PARTY SOFTWARE' AS SUB_GRUP_TITLE
							,'(+) Accured COGS Previous Year' AS TITLE
							,'SLS-01' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'2. COGS - 3rd PARTY SOFTWARE' AS SUB_GRUP_TITLE
							,'(-) Accured COGS Current Year' AS TITLE
							,'SLS-02' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'2. COGS - 3rd PARTY SOFTWARE' AS SUB_GRUP_TITLE
							,'(-/+) Others Management Adjustment' AS TITLE
							,'SLS-03' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'3. COGS - OWN SOFTWARE' AS SUB_GRUP_TITLE
							,'COGS - OWN SOFTWARE' AS TITLE
							,'SLS-00' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'3. COGS - OWN SOFTWARE' AS SUB_GRUP_TITLE
							,'(+) Accured COGS Previous Year' AS TITLE
							,'SLS-01' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'3. COGS - OWN SOFTWARE' AS SUB_GRUP_TITLE
							,'(-) Accured COGS Current Year' AS TITLE
							,'SLS-02' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'3. COGS - OWN SOFTWARE' AS SUB_GRUP_TITLE
							,'(-/+) Others Management Adjustment' AS TITLE
							,'SLS-03' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'4. COGS - TECHNOLOGY SERVICE' AS SUB_GRUP_TITLE
							,'COGS - TECHNOLOGY SERVICE' AS TITLE
							,'SLS-00' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'4. COGS - TECHNOLOGY SERVICE' AS SUB_GRUP_TITLE
							,'(+) Accured COGS Previous Year' AS TITLE
							,'SLS-01' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'4. COGS - TECHNOLOGY SERVICE' AS SUB_GRUP_TITLE
							,'(-) Accured COGS Current Year' AS TITLE
							,'SLS-02' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'4. COGS - TECHNOLOGY SERVICE' AS SUB_GRUP_TITLE
							,'(-/+) Others Management Adjustment' AS TITLE
							,'SLS-03' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'5. COGS - HARDWARE SERVICE' AS SUB_GRUP_TITLE
							,'COGS - HARDWARE SERVICE' AS TITLE
							,'SLS-00' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'5. COGS - HARDWARE SERVICE' AS SUB_GRUP_TITLE
							,'(+) Accured COGS Previous Year' AS TITLE
							,'SLS-01' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'5. COGS - HARDWARE SERVICE' AS SUB_GRUP_TITLE
							,'(-) Accured COGS Current Year' AS TITLE
							,'SLS-02' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'5. COGS - HARDWARE SERVICE' AS SUB_GRUP_TITLE
							,'(-/+) Others Management Adjustment' AS TITLE
							,'SLS-03' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'6. COGS - MANAGE SERVICE' AS SUB_GRUP_TITLE
							,'COGS - MANAGE SERVICE' AS TITLE
							,'SLS-00' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'6. COGS - MANAGE SERVICE' AS SUB_GRUP_TITLE
							,'(+) Accured COGS Previous Year' AS TITLE
							,'SLS-01' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'6. COGS - MANAGE SERVICE' AS SUB_GRUP_TITLE
							,'(-) Accured COGS Current Year' AS TITLE
							,'SLS-02' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'6. COGS - MANAGE SERVICE' AS SUB_GRUP_TITLE
							,'(-/+) Others Management Adjustment' AS TITLE
							,'SLS-03' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'02-COGS CORRECTION' AS SUB_GRUP_SC
							,'1. COGS FA' AS SUB_GRUP_TITLE
							,'(-) COGS FA' AS TITLE
							,'SLS-0401' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'02-COGS CORRECTION' AS SUB_GRUP_SC
							,'2. COGS INTERCOY' AS SUB_GRUP_TITLE
							,'(-) COGS INTERCOY' AS TITLE
							,'SLS-0402' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT  '02-COGS' AS GRUP_SC
							,'02-COGS CORRECTION' AS SUB_GRUP_SC
							,'3. Others COGS Adjustment' AS SUB_GRUP_TITLE
							,'(-/+) Others Management Adjustment' AS TITLE
							,'SLS-0403' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'' AS SOURCE_FROM
					UNION ALL
					SELECT	'02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,CASE	WHEN DIMS.ITEM_CAT = 'HW01' THEN '1. COGS - HARDWARE'
									WHEN DIMS.ITEM_CAT = 'PS01' THEN '2. COGS - 3rd PARTY SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS02' THEN '3. COGS - OWN SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS03' THEN '4. COGS - TECHNOLOGY SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS04' THEN '5. COGS - HARDWARE SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS05' THEN '6. COGS - MANAGE SERVICE'
							END AS SUB_GRUP_TITLE
							,CASE	WHEN DIMS.ITEM_CAT = 'HW01' THEN 'COGS - HARDWARE'
									WHEN DIMS.ITEM_CAT = 'PS01' THEN 'COGS - 3rd PARTY SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS02' THEN 'COGS - OWN SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS03' THEN 'COGS - TECHNOLOGY SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS04' THEN 'COGS - HARDWARE SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS05' THEN 'COGS - MANAGE SERVICE'
							END AS TITLE
							,'SLS-00' AS SORT_SLS
							,SUM(GLE.[Amount]) AS AMOUNT_AJ
							,0 AS AMOUNT_SP
							,'AUTOJAYA' AS SOURCE_FROM
					FROM [ACS].[dbo].[AUTOJAYA$G_L Entry] GLE
					LEFT JOIN	(
									SELECT	DIM.DIM_ID
											,MAX(DIM.BRANCHES) AS BRANCHES
											,MAX(DIM.ITEM_CAT) AS ITEM_CAT
											,MAX(DIM.SALESMAN) AS SALESMAN
									FROM	(
												SELECT [Dimension Set ID] AS DIM_ID
													  ,CASE WHEN [Dimension Code] = 'BRANCHES' THEN [Dimension Value Code] ELSE NULL END AS BRANCHES
													  ,CASE WHEN [Dimension Code] = 'ITEM CATEGORY' THEN [Dimension Value Code] ELSE NULL END AS ITEM_CAT
													  ,CASE WHEN [Dimension Code] = 'SALESMAN' THEN [Dimension Value Code] ELSE NULL END AS SALESMAN
												FROM [ACS].[dbo].[AUTOJAYA$Dimension Set Entry]
											) DIM
									GROUP BY DIM.DIM_ID
								) DIMS ON DIMS.DIM_ID = GLE.[Dimension Set ID]
					WHERE	GLE.[G_L Account No_] BETWEEN '500.110.00'  AND '500.111.00' AND
							DIMS.ITEM_CAT <> '' AND
							(DIMS.BRANCHES = @Cabang OR @Cabang = 'ALL') AND
							(GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <= @TglInvUpto)
					GROUP BY DIMS.ITEM_CAT
					UNION ALL
					SELECT	'02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'7. Rebate' AS SUB_GRUP_TITLE
							,'Rebate' AS TITLE
							,'SLS-04' AS SORT_SLS
							,ISNULL(SUM(GLE.[Amount]),0) AS AMOUNT_AJ
							,0 AS AMOUNT_SP
							,'AUTOJAYA' AS SOURCE_FROM
					FROM [ACS].[dbo].[AUTOJAYA$G_L Entry] GLE
					WHERE	GLE.[G_L Account No_] = '600.110.00'
							AND (GLE.[Global Dimension 1 Code] = @Cabang OR @Cabang = 'ALL')
							AND (GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <= @TglInvUpto)
					UNION ALL
					SELECT	'02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'7. Rebate' AS SUB_GRUP_TITLE
							,'Rebate' AS TITLE
							,'SLS-04' AS SORT_SLS
							,ISNULL(SUM(GLE.[Amount]),0) AS AMOUNT_AJ
							,0 AS AMOUNT_SP
							,'AJ-ADJ' AS SOURCE_FROM
					FROM [ACS].[dbo].[AJ-ADJ$G_L Entry] GLE
					WHERE	GLE.[G_L Account No_] = '600.110.00'
							AND (GLE.[Global Dimension 1 Code] = @Cabang OR @Cabang = 'ALL')
							AND (GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <= @TglInvUpto)
					UNION ALL
					SELECT	'02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,CASE	WHEN DIMS.ITEM_CAT = 'HW01' THEN '1. COGS - HARDWARE'
									WHEN DIMS.ITEM_CAT = 'PS01' THEN '2. COGS - 3rd PARTY SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS02' THEN '3. COGS - OWN SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS03' THEN '4. COGS - TECHNOLOGY SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS04' THEN '5. COGS - HARDWARE SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS05' THEN '6. COGS - MANAGE SERVICE'
							 END AS SUB_GRUP_TITLE
							,'(-/+) Others Management Adjustment' AS TITLE
							,'SLS-03' AS SORT_SLS
							,SUM(GLE.[Amount]) AS AMOUNT_AJ
							, 0 AS AMOUNT_SP
							,'AJ-ADJ' AS SOURCE_FROM
					FROM [ACS].[dbo].[AJ-ADJ$G_L Entry] GLE
					LEFT JOIN	(
									SELECT	DIM.DIM_ID
											,MAX(DIM.BRANCHES) AS BRANCHES
											,MAX(DIM.ITEM_CAT) AS ITEM_CAT
											,MAX(DIM.SALESMAN) AS SALESMAN
									FROM	(
												SELECT [Dimension Set ID] AS DIM_ID
													  ,CASE WHEN [Dimension Code] = 'BRANCHES' THEN [Dimension Value Code] ELSE NULL END AS BRANCHES
													  ,CASE WHEN [Dimension Code] = 'ITEM CATEGORY' THEN [Dimension Value Code] ELSE NULL END AS ITEM_CAT
													  ,CASE WHEN [Dimension Code] = 'SALESMAN' THEN [Dimension Value Code] ELSE NULL END AS SALESMAN
												FROM [ACS].[dbo].[AJ-ADJ$Dimension Set Entry]
											) DIM
									GROUP BY DIM.DIM_ID
								) DIMS ON DIMS.DIM_ID = GLE.[Dimension Set ID]
					WHERE	GLE.[G_L Account No_] BETWEEN '500.110.00'  AND '500.111.00' AND
							DIMS.ITEM_CAT <> '' AND
							(DIMS.BRANCHES = @Cabang OR @Cabang = 'ALL') AND
							(GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <= @TglInvUpto)
					GROUP BY DIMS.ITEM_CAT
					UNION ALL
					SELECT	'02-COGS' AS GRUP_SC
							,'02-COGS CORRECTION' AS SUB_GRUP_SC
							, SLC.SALES_TITLE AS SUB_GRUP_TITLE
							, SLC.SALES_TITLE2 AS TITLE
							, SLC.SORT_SLS
							, CASE WHEN  SLC.SALES_TITLE = '1. COGS FA' THEN SUM(SLC.[Amount]) ELSE 0 END AS AMOUNT_AJ
							, CASE WHEN  SLC.SALES_TITLE = '1. COGS FA' THEN 0 ELSE SUM(SLC.[Amount]) END AS AMOUNT_SP
							,'AUTOJAYA' AS SOURCE_FROM
					FROM	(
								SELECT	CASE WHEN GLE.[Source No_] = 'SOPE001' THEN '2. COGS INTERCOY' ELSE '1. COGS FA' END AS SALES_TITLE
										,CASE WHEN GLE.[Source No_] = 'SOPE001' THEN '(-) COGS INTERCOY' ELSE '(-) COGS FA' END AS SALES_TITLE2
										,CASE WHEN GLE.[Source No_] = 'SOPE001' THEN 'SLS-0402' ELSE 'SLS-0401' END AS SORT_SLS
										, GLE.[Amount]
										, GLE.[Global Dimension 1 Code] AS BRANCHES
								FROM [ACS].[dbo].[AUTOJAYA$G_L Entry] GLE
								WHERE GLE.[G_L Account No_] IN ('400.110.01', '410.110.01', '420.110.01')
										AND GLE.[Document No_] <> '9SIAT200197'
										AND (GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <=  @TglInvUpto)
							) SLC
					WHERE (SLC.BRANCHES = @Cabang OR @Cabang = 'ALL')
					GROUP BY SLC.SALES_TITLE, SLC.SALES_TITLE2, SLC.SORT_SLS
					UNION ALL
					SELECT	'02-COGS' AS GRUP_SC
							,'02-COGS CORRECTION' AS SUB_GRUP_SC
							, SLC.SALES_TITLE AS SUB_GRUP_TITLE
							, SLC.SALES_TITLE2 AS TITLE
							, SLC.SORT_SLS
							, CASE WHEN SLC.AMT_COM = 'AJ' THEN SUM(SLC.[Amount]) ELSE 0 END AS AMOUNT_AJ
							, CASE WHEN SLC.AMT_COM = 'SP' THEN SUM(SLC.[Amount]) ELSE 0 END AS AMOUNT_SP
							,'AJ-ADJ' AS SOURCE_FROM
					FROM	(
								SELECT	'3. Others COGS Adjustment' AS SALES_TITLE
										,'(-/+) Others Management Adjustment' AS SALES_TITLE2
										,'SLS-0403' AS SORT_SLS
										, CASE WHEN GLE.[Description] LIKE 'FA%' THEN 'AJ' ELSE 'SP' END AS AMT_COM
										, GLE.[Amount]
								FROM [ACS].[dbo].[AJ-ADJ$G_L Entry] GLE
								WHERE GLE.[G_L Account No_] IN ('400.110.01', '410.110.01', '420.110.01')
										AND (GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <=  @TglInvUpto)
							) SLC
					WHERE @Cabang = 'ALL' OR @Cabang = '10'
					GROUP BY SLC.SALES_TITLE, SLC.SALES_TITLE2, SLC.SORT_SLS, SLC.AMT_COM
					UNION ALL
					SELECT	'02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,CASE	WHEN DIMS.ITEM_CAT = 'HW01' THEN '1. COGS - HARDWARE'
									WHEN DIMS.ITEM_CAT = 'PS01' THEN '2. COGS - 3rd PARTY SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS02' THEN '3. COGS - OWN SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS03' THEN '4. COGS - TECHNOLOGY SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS04' THEN '5. COGS - HARDWARE SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS05' THEN '6. COGS - MANAGE SERVICE'
							END AS SUB_GRUP_TITLE
							,CASE	WHEN DIMS.ITEM_CAT = 'HW01' THEN 'COGS - HARDWARE'
									WHEN DIMS.ITEM_CAT = 'PS01' THEN 'COGS - 3rd PARTY SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS02' THEN 'COGS - OWN SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS03' THEN 'COGS - TECHNOLOGY SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS04' THEN 'COGS - HARDWARE SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS05' THEN 'COGS - MANAGE SERVICE'
							END AS TITLE
							,'SLS-00' AS SORT_SLS
							,0 AS AMOUNT_AJ
							,SUM(GLE.[Amount]) AS AMOUNT_SP
							,'SOLUSI' AS SOURCE_FROM
					FROM [ACS].[dbo].[SOLUSI$G_L Entry] GLE
					LEFT JOIN	(
									SELECT	DIM.DIM_ID
											,MAX(DIM.BRANCHES) AS BRANCHES
											,MAX(DIM.ITEM_CAT) AS ITEM_CAT
											,MAX(DIM.SALESMAN) AS SALESMAN
									FROM	(
												SELECT [Dimension Set ID] AS DIM_ID
													  ,CASE WHEN [Dimension Code] = 'BRANCHES' THEN [Dimension Value Code] ELSE NULL END AS BRANCHES
													  ,CASE WHEN [Dimension Code] = 'ITEM CATEGORY' THEN [Dimension Value Code] ELSE NULL END AS ITEM_CAT
													  ,CASE WHEN [Dimension Code] = 'SALESMAN' THEN [Dimension Value Code] ELSE NULL END AS SALESMAN
												FROM [ACS].[dbo].[SOLUSI$Dimension Set Entry]
											) DIM
									GROUP BY DIM.DIM_ID
								) DIMS ON DIMS.DIM_ID = GLE.[Dimension Set ID]
					WHERE	GLE.[G_L Account No_] BETWEEN '500.110.00'  AND '500.111.00' AND
							DIMS.ITEM_CAT <> '' AND
							(DIMS.BRANCHES = @Cabang OR @Cabang = 'ALL') AND
							(GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <= @TglInvUpto)
					GROUP BY DIMS.ITEM_CAT
					UNION ALL
					SELECT	'02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'7. Rebate' AS SUB_GRUP_TITLE
							,'Rebate' AS TITLE
							,'SLS-04' AS SORT_SLS
							,0 AS AMOUNT_AJ
							,ISNULL(SUM(GLE.[Amount]),0) AS AMOUNT_SP
							,'SOLUSI' AS SOURCE_FROM
					FROM [ACS].[dbo].[SOLUSI$G_L Entry] GLE
					WHERE	GLE.[G_L Account No_] IN ( '600.110.00', '600.120.00')
							AND (GLE.[Global Dimension 1 Code] = @Cabang OR @Cabang = 'ALL')
							AND (GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <= @TglInvUpto)
					UNION ALL
					SELECT	'02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,'7. Rebate' AS SUB_GRUP_TITLE
							,'Rebate' AS TITLE
							,'SLS-04' AS SORT_SLS
							,0 AS AMOUNT_AJ
							,ISNULL(SUM(GLE.[Amount]),0) AS AMOUNT_SP
							,'SP-ADJ' AS SOURCE_FROM
					FROM [ACS].[dbo].[SP-ADJ$G_L Entry] GLE
					WHERE	GLE.[G_L Account No_] IN ( '600.110.00', '600.120.00')
							AND (GLE.[Global Dimension 1 Code] = @Cabang OR @Cabang = 'ALL')
							AND (GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <= @TglInvUpto)
					UNION ALL
					SELECT	'02-COGS' AS GRUP_SC
							,'01-COGS' AS SUB_GRUP_SC
							,CASE	WHEN DIMS.ITEM_CAT = 'HW01' THEN '1. COGS - HARDWARE'
									WHEN DIMS.ITEM_CAT = 'PS01' THEN '2. COGS - 3rd PARTY SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS02' THEN '3. COGS - OWN SOFTWARE'
									WHEN DIMS.ITEM_CAT = 'PS03' THEN '4. COGS - TECHNOLOGY SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS04' THEN '5. COGS - HARDWARE SERVICE'
									WHEN DIMS.ITEM_CAT = 'PS05' THEN '6. COGS - MANAGE SERVICE'
							 END AS SUB_GRUP_TITLE
							,'(-/+) Others Management Adjustment' AS TITLE
							,'SLS-03' AS SORT_SLS
							, 0 AS AMOUNT_AJ
							, SUM(GLE.[Amount]) AS AMOUNT_SP
							,'SP-ADJ' AS SOURCE_FROM
					FROM [ACS].[dbo].[SP-ADJ$G_L Entry] GLE
					LEFT JOIN	(
									SELECT	DIM.DIM_ID
											,MAX(DIM.BRANCHES) AS BRANCHES
											,MAX(DIM.ITEM_CAT) AS ITEM_CAT
											,MAX(DIM.SALESMAN) AS SALESMAN
									FROM	(
												SELECT [Dimension Set ID] AS DIM_ID
													  ,CASE WHEN [Dimension Code] = 'BRANCHES' THEN [Dimension Value Code] ELSE NULL END AS BRANCHES
													  ,CASE WHEN [Dimension Code] = 'ITEM CATEGORY' THEN [Dimension Value Code] ELSE NULL END AS ITEM_CAT
													  ,CASE WHEN [Dimension Code] = 'SALESMAN' THEN [Dimension Value Code] ELSE NULL END AS SALESMAN
												FROM [ACS].[dbo].[SP-ADJ$Dimension Set Entry]
											) DIM
									GROUP BY DIM.DIM_ID
								) DIMS ON DIMS.DIM_ID = GLE.[Dimension Set ID]
					WHERE	GLE.[G_L Account No_] BETWEEN '500.110.00'  AND '500.111.00' AND
							DIMS.ITEM_CAT <> '' AND
							(DIMS.BRANCHES = @Cabang OR @Cabang = 'ALL') AND
							(GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <= @TglInvUpto)
					GROUP BY DIMS.ITEM_CAT
					UNION ALL
					SELECT	'02-COGS' AS GRUP_SC
							,'02-COGS CORRECTION' AS SUB_GRUP_SC
							, SLC.SALES_TITLE AS SUB_GRUP_TITLE
							, SLC.SALES_TITLE2 AS TITLE
							, SLC.SORT_SLS
							, CASE WHEN  SLC.SALES_TITLE = '1. COGS FA' THEN 0 ELSE SUM(SLC.[Amount]) END AS AMOUNT_AJ
							, CASE WHEN  SLC.SALES_TITLE = '1. COGS FA' THEN SUM(SLC.[Amount]) ELSE 0 END AS AMOUNT_SP
							,'SOLUSI' AS SOURCE_FROM
					FROM	(
								SELECT	CASE WHEN GLE.[Source No_] <> 'SOPE001' THEN '2. COGS INTERCOY' ELSE '1. COGS FA' END AS SALES_TITLE
										,CASE WHEN GLE.[Source No_] <> 'SOPE001' THEN '(-) COGS INTERCOY' ELSE '(-) COGS FA' END AS SALES_TITLE2
										,CASE WHEN GLE.[Source No_] <> 'SOPE001' THEN 'SLS-0402' ELSE 'SLS-0401' END AS SORT_SLS
										, GLE.[Amount]
										, GLE.[Global Dimension 1 Code] AS BRANCHES
								FROM [ACS].[dbo].[SOLUSI$G_L Entry] GLE
								WHERE GLE.[G_L Account No_] IN ('400.110.01', '410.110.01', '420.110.01')
										AND (GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <=  @TglInvUpto)
							) SLC
					WHERE (SLC.BRANCHES = @Cabang OR @Cabang = 'ALL')
					GROUP BY SLC.SALES_TITLE, SLC.SALES_TITLE2, SLC.SORT_SLS
					UNION ALL
					SELECT	'02-COGS' AS GRUP_SC
							,'02-COGS CORRECTION' AS SUB_GRUP_SC
							, SLC.SALES_TITLE AS SUB_GRUP_TITLE
							, SLC.SALES_TITLE2 AS TITLE
							, SLC.SORT_SLS
							, CASE WHEN SLC.AMT_COM = 'AJ' THEN SUM(SLC.[Amount]) ELSE 0 END AS AMOUNT_AJ
							, CASE WHEN SLC.AMT_COM = 'SP' THEN SUM(SLC.[Amount]) ELSE 0 END AS AMOUNT_SP
							,'SP-ADJ' AS SOURCE_FROM
					FROM	(
								SELECT	'3. Others COGS Adjustment' AS SALES_TITLE
										,'(-/+) Others Management Adjustment' AS SALES_TITLE2
										,'SLS-0403' AS SORT_SLS
										, CASE WHEN GLE.[Description] LIKE 'FA%' THEN 'SP' ELSE 'AJ' END AS AMT_COM
										, GLE.[Amount]
								FROM [ACS].[dbo].[SP-ADJ$G_L Entry] GLE
								WHERE GLE.[G_L Account No_] IN ('400.110.01', '410.110.01', '420.110.01')
										AND (GLE.[Posting Date] >= @TglInvFrom AND GLE.[Posting Date] <=  @TglInvUpto)
							) SLC
					WHERE @Cabang = 'ALL' OR @Cabang = '10'
					GROUP BY SLC.SALES_TITLE, SLC.SALES_TITLE2, SLC.SORT_SLS, SLC.AMT_COM
				) X;		
		RETURN  ;
	END;
	--
	IF @Action = 'DELETE' 
	BEGIN
		DELETE FROM [dbo].[TEMP10_SALES_COGS_CORRECTION]
		WHERE [PROSES_ID] = @ProsesId;
		--
		RETURN  ;
	END;
END;
