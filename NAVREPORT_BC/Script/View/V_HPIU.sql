CREATE VIEW V_HPIU AS 

SELECT T05.NIP, T05.KdJnsP, T05.TgDoku, T05.Piutang, T05.Bunga, 
		T06.JmlAngs, T06.JmlBunga, 
		T07.BayPokok, T07.BayBunga 
FROM T05HPIU T05

LEFT JOIN 
(
SELECT T06.NIP, T06.KdJnsP, T06.TgDoku, SUM(T06.JmlAngs) AS JmlAngs, SUM(T06.JmlBunga) AS JmlBunga FROM T06DPIU T06
LEFT JOIN T07BAYP T07 
ON T06.NIP = T07.NIP  AND T06.KdJnsP = T07.KdJnsP AND  T06.TgDoku = T07.TgPiut AND  T06.PRDANGS = T07.TGDOKU 
WHERE T07.NIP IS NULL AND COALESCE(T07.COMP,'P') = 'P' 
GROUP BY T06.NIP, T06.KdJnsP, T06.TgDoku,JmlBunga,JmlAngs
) T06

ON T05.NIP = T06.NIP AND T05.KdJnsP = T06.KdJnsP AND T05.TgDoku = T06.TgDoku 

LEFT JOIN 
(
SELECT T07.NIP, T07.KdJnsP, T07.TgPiut, SUM(T07.BayPokok) AS BayPokok, SUM(T07.BayBunga) AS BayBunga 
FROM T07BAYP T07 
GROUP BY T07.NIP, T07.KdJnsP, T07.TgPiut,BayPokok,BayBunga
) T07 
ON T05.NIP = T07.NIP  AND T05.KdJnsP = T07.KdJnsP AND  T05.TgDoku = T07.TgPiut 