CREATE VIEW V_LHCAB 
AS

SELECT M08.KdCaba,M08.NmCaba,M08.SkCaba,M08.KaCaba,M08.AlCaba,M08.Kota,M08.Telpon,M08.Fax,M08.NoAcc,M08.JABATAN,
CASE 
WHEN M08.NPWP=' ' OR CAST (M08.NPWP AS DECIMAL(20,0))=0
	THEN ' '
	
	ELSE
		SUBSTRING (RIGHT('00000000000000'||M08.NPWP,15) FROM 1 FOR 2)||'.'||
		SUBSTRING (RIGHT('00000000000000'||M08.NPWP,15) FROM 3 FOR 3)||'.'||
		SUBSTRING (RIGHT('00000000000000'||M08.NPWP,15) FROM 6 FOR 3)||'.'||
		SUBSTRING (RIGHT('00000000000000'||M08.NPWP,15) FROM 9 FOR 1)||'.'||
		SUBSTRING (RIGHT('00000000000000'||M08.NPWP,15) FROM 10 FOR 3)||'.'||
		SUBSTRING (RIGHT('00000000000000'||M08.NPWP,15) FROM 13 FOR 3)
	END AS NPWP, 
CASE     
WHEN M08.NPWP2=' ' OR CAST (M08.NPWP2 AS DECIMAL(20,0))=0
	THEN ' '
	
	ELSE
		SUBSTRING (RIGHT('00000000000000'||M08.NPWP2,15) FROM 1 FOR 2)||'.'||
		SUBSTRING (RIGHT('00000000000000'||M08.NPWP2,15) FROM 3 FOR 3)||'.'||
		SUBSTRING (RIGHT('00000000000000'||M08.NPWP2,15) FROM 6 FOR 3)||'.'||
		SUBSTRING (RIGHT('00000000000000'||M08.NPWP2,15) FROM 9 FOR 1)||'.'||
		SUBSTRING (RIGHT('00000000000000'||M08.NPWP2,15) FROM 10 FOR 3)||'.'||
		SUBSTRING (RIGHT('00000000000000'||M08.NPWP2,15) FROM 13 FOR 3)
	END AS NPWP2, 

	M09.FlgDpPt,M09.KdDpPt,M03.NmDpPt,M09.Persen,M09.Nilai,M09.KdCurr, M09.Trans

FROM M08HCAB M08 LEFT  JOIN M09DCAB M09 ON M08.KdCaba=M09.KdCab
LEFT JOIN  M03DPPT M03 ON M03.FlgDpPt=M09.FlgDpPt AND M03.KdDpPt=M09.KdDpPt